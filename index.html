<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine Time Tracker</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .medicine-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .medicine-active {
            background-color: #e6f7e6;
            border-left: 5px solid #4CAF50;
        }
        .medicine-inactive {
            background-color: #f9f9f9;
        }
        .status {
            font-weight: bold;
        }
        .active {
            color: #4CAF50;
        }
        .inactive {
            color: #f44336;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .current-time {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>Medicine Time Tracker</h1>
    <div class="current-time" id="currentTime">Current Time: </div>
    <div id="medicinesContainer"></div>

    <script>
        // Your Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAqbz6JQXKRsQL4vemywlxx5AHOKP5vlY0",
  authDomain: "caresync-2b3b8.firebaseapp.com",
  databaseURL: "https://caresync-2b3b8-default-rtdb.firebaseio.com",
  projectId: "caresync-2b3b8",
  storageBucket: "caresync-2b3b8.firebasestorage.app",
  messagingSenderId: "372851911782",
  appId: "1:372851911782:web:9f2491d89ffe4e1e5011a7"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Function to format time to HH:MM (with leading zeros)
        function formatTime(hours, minutes) {
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // Function to check medicine times and update status
        function checkMedicineTimes() {
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentTimeFormatted = formatTime(currentHours, currentMinutes);
            
            // Update the displayed current time
            document.getElementById('currentTime').textContent = `Current Time: ${currentTimeFormatted}`;
            
            // Get reference to medicines in database
            const medicinesRef = database.ref('medicines');
            
            medicinesRef.once('value').then((snapshot) => {
                const medicines = snapshot.val();
                const updates = {};
                
                for (const medicineId in medicines) {
                    if (medicines.hasOwnProperty(medicineId)) {
                        const medicine = medicines[medicineId];
                        const medicineTime = medicine.time;
                        
                        // Split time and ensure two-digit format
                        const [timeHours, timeMinutes] = medicineTime.split(':').map(part => part.padStart(2, '0'));
                        const formattedMedicineTime = `${timeHours}:${timeMinutes}`;
                        
                        // Compare with current time
                        const isActive = formattedMedicineTime === currentTimeFormatted;
                        updates[`medicine_status/${medicineId}`] = isActive;
                        
                        // Update UI for this medicine
                        updateMedicineUI(medicineId, medicine.name, formattedMedicineTime, isActive);
                    }
                }
                
                // Update all statuses in the database at once
                database.ref().update(updates);
            });
        }

        // Function to update the UI for a specific medicine
        function updateMedicineUI(medicineId, name, time, isActive) {
            let medicineElement = document.getElementById(`medicine-${medicineId}`);
            
            if (!medicineElement) {
                medicineElement = document.createElement('div');
                medicineElement.id = `medicine-${medicineId}`;
                medicineElement.className = `medicine-card ${isActive ? 'medicine-active' : 'medicine-inactive'}`;
                
                const medicineInfo = document.createElement('div');
                medicineInfo.innerHTML = `<strong>${name}</strong><br>Scheduled Time: ${time}`;
                
                const statusElement = document.createElement('div');
                statusElement.className = `status ${isActive ? 'active' : 'inactive'}`;
                statusElement.textContent = isActive ? 'ACTIVE - Time to take!' : 'Inactive';
                
                medicineElement.appendChild(medicineInfo);
                medicineElement.appendChild(statusElement);
                
                document.getElementById('medicinesContainer').appendChild(medicineElement);
            } else {
                medicineElement.className = `medicine-card ${isActive ? 'medicine-active' : 'medicine-inactive'}`;
                const statusElement = medicineElement.querySelector('.status');
                statusElement.className = `status ${isActive ? 'active' : 'inactive'}`;
                statusElement.textContent = isActive ? 'ACTIVE - Time to take!' : 'Inactive';
            }
        }

        // Initialize and check times every minute
        document.addEventListener('DOMContentLoaded', () => {
            checkMedicineTimes();
            setInterval(checkMedicineTimes, 1000; // Check every minute
        });
    </script>
</body>
</html>
